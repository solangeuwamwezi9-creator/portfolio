<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Musanze Market ‚Äî Local Vendors, Digital Presence</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --rust: #C4601A;
    --ochre: #D4A043;
    --cream: #F7F0E6;
    --bark: #3B2A1A;
    --sage: #7A9E7E;
    --dust: #E8D8C4;
    --white: #FFFDF9;
    --shadow: rgba(59,42,26,0.12);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--cream);
    color: var(--bark);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* HEADER */
  header {
    background: var(--bark);
    color: var(--cream);
    padding: 0 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 72px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 24px rgba(0,0,0,0.25);
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    font-weight: 900;
    letter-spacing: -0.5px;
  }
  .logo span { color: var(--ochre); }

  .header-right {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .cart-btn {
    background: var(--rust);
    color: var(--white);
    border: none;
    padding: 10px 22px;
    border-radius: 4px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background 0.2s, transform 0.15s;
    position: relative;
  }
  .cart-btn:hover { background: #a84f12; transform: translateY(-1px); }

  .cart-badge {
    background: var(--ochre);
    color: var(--bark);
    border-radius: 50%;
    width: 20px; height: 20px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.72rem;
    font-weight: 700;
  }

  /* HERO BAND */
  .hero {
    background: var(--rust);
    padding: 56px 40px 48px;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    right: -80px; top: -80px;
    width: 380px; height: 380px;
    border-radius: 50%;
    background: rgba(212,160,67,0.18);
  }
  .hero::after {
    content: '';
    position: absolute;
    left: 30%; bottom: -60px;
    width: 200px; height: 200px;
    border-radius: 50%;
    background: rgba(255,255,255,0.06);
  }

  .hero-inner { max-width: 600px; position: relative; }
  .hero-tag {
    display: inline-block;
    background: var(--ochre);
    color: var(--bark);
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 4px 12px;
    border-radius: 2px;
    margin-bottom: 16px;
  }
  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.2rem, 5vw, 3.6rem);
    font-weight: 900;
    color: var(--white);
    line-height: 1.1;
    margin-bottom: 16px;
  }
  .hero h1 em { color: var(--ochre); font-style: italic; }
  .hero p {
    color: rgba(247,240,230,0.8);
    font-size: 1rem;
    line-height: 1.6;
    max-width: 440px;
  }

  /* MAIN LAYOUT */
  .main-layout {
    max-width: 1300px;
    margin: 0 auto;
    padding: 40px 24px;
    display: grid;
    grid-template-columns: 240px 1fr;
    gap: 40px;
  }

  /* SIDEBAR FILTERS */
  .sidebar {
    position: sticky;
    top: 100px;
    align-self: start;
  }

  .filter-section {
    background: var(--white);
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: 0 2px 12px var(--shadow);
  }

  .filter-section h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 14px;
    color: var(--bark);
    padding-bottom: 10px;
    border-bottom: 2px solid var(--dust);
  }

  .category-btn {
    display: block;
    width: 100%;
    background: none;
    border: none;
    text-align: left;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    color: var(--bark);
    transition: background 0.15s, color 0.15s;
    margin-bottom: 4px;
  }
  .category-btn:hover { background: var(--dust); }
  .category-btn.active { background: var(--rust); color: var(--white); font-weight: 500; }

  .price-range { width: 100%; }
  input[type="range"] {
    width: 100%;
    accent-color: var(--rust);
    cursor: pointer;
  }
  .price-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #888;
    margin-top: 6px;
  }

  /* PRODUCT GRID */
  .products-area {}

  .products-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }
  .products-count {
    font-size: 0.88rem;
    color: #888;
  }
  .products-count strong { color: var(--bark); }

  .sort-select {
    border: 1.5px solid var(--dust);
    border-radius: 4px;
    padding: 8px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    background: var(--white);
    color: var(--bark);
    cursor: pointer;
    outline: none;
  }
  .sort-select:focus { border-color: var(--rust); }

  .search-bar {
    display: flex;
    align-items: center;
    background: var(--white);
    border: 1.5px solid var(--dust);
    border-radius: 4px;
    padding: 8px 16px;
    gap: 8px;
    transition: border-color 0.2s;
  }
  .search-bar:focus-within { border-color: var(--rust); }
  .search-bar input {
    border: none; outline: none;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.88rem;
    background: transparent;
    color: var(--bark);
    width: 180px;
  }
  .search-bar svg { opacity: 0.45; flex-shrink: 0; }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 24px;
  }

  .product-card {
    background: var(--white);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 12px var(--shadow);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    animation: fadeUp 0.4s ease both;
  }
  .product-card:hover { transform: translateY(-4px); box-shadow: 0 8px 28px var(--shadow); }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .product-img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    background: var(--dust);
    display: flex; align-items: center; justify-content: center;
    font-size: 3rem;
    position: relative;
  }

  .product-badge {
    position: absolute;
    top: 10px; left: 10px;
    background: var(--sage);
    color: var(--white);
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 3px 8px;
    border-radius: 2px;
  }

  .product-info {
    padding: 16px;
  }

  .vendor-tag {
    font-size: 0.72rem;
    color: var(--rust);
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    margin-bottom: 4px;
  }

  .product-name {
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 6px;
    line-height: 1.3;
  }

  .product-desc {
    font-size: 0.8rem;
    color: #888;
    line-height: 1.5;
    margin-bottom: 12px;
  }

  .product-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .product-price {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--rust);
  }
  .product-price span { font-size: 0.72rem; font-weight: 400; color: #aaa; }

  .add-btn {
    background: var(--bark);
    color: var(--white);
    border: none;
    border-radius: 4px;
    width: 34px; height: 34px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.2rem;
    transition: background 0.15s, transform 0.1s;
  }
  .add-btn:hover { background: var(--rust); transform: scale(1.1); }

  /* EMPTY STATE */
  .empty-state {
    grid-column: 1/-1;
    text-align: center;
    padding: 60px 20px;
    color: #aaa;
  }
  .empty-state div { font-size: 3rem; margin-bottom: 12px; }

  /* CART DRAWER */
  .cart-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 200;
    animation: fadeIn 0.2s ease;
  }
  .cart-overlay.open { display: block; }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .cart-drawer {
    position: fixed;
    right: -480px;
    top: 0; bottom: 0;
    width: 420px;
    background: var(--white);
    z-index: 201;
    transition: right 0.35s cubic-bezier(0.4,0,0.2,1);
    display: flex;
    flex-direction: column;
    box-shadow: -8px 0 40px rgba(0,0,0,0.2);
  }
  .cart-drawer.open { right: 0; }

  .cart-header {
    padding: 24px;
    border-bottom: 2px solid var(--dust);
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--bark);
    color: var(--white);
  }
  .cart-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    font-weight: 700;
  }

  .close-btn {
    background: none; border: none;
    color: var(--cream); cursor: pointer;
    font-size: 1.5rem; line-height: 1;
    opacity: 0.7; transition: opacity 0.2s;
  }
  .close-btn:hover { opacity: 1; }

  .cart-items {
    flex: 1;
    overflow-y: auto;
    padding: 20px 24px;
  }

  .cart-item {
    display: grid;
    grid-template-columns: 56px 1fr auto;
    gap: 14px;
    align-items: center;
    padding: 14px 0;
    border-bottom: 1px solid var(--dust);
    animation: fadeUp 0.3s ease;
  }

  .cart-item-emoji {
    width: 56px; height: 56px;
    background: var(--cream);
    border-radius: 6px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.8rem;
  }

  .cart-item-name {
    font-family: 'Playfair Display', serif;
    font-size: 0.95rem;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .cart-item-vendor { font-size: 0.75rem; color: var(--rust); }

  .cart-item-controls {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
  }

  .cart-item-price { font-weight: 700; font-size: 0.95rem; }

  .qty-ctrl {
    display: flex; align-items: center; gap: 6px;
  }
  .qty-btn {
    background: var(--dust); border: none;
    width: 24px; height: 24px; border-radius: 4px;
    cursor: pointer; font-size: 1rem; line-height: 1;
    transition: background 0.15s;
  }
  .qty-btn:hover { background: var(--ochre); }
  .qty-num { font-size: 0.9rem; font-weight: 600; min-width: 20px; text-align: center; }

  .cart-empty {
    text-align: center;
    padding: 60px 20px;
    color: #bbb;
  }
  .cart-empty div { font-size: 3rem; margin-bottom: 12px; }

  .cart-footer {
    padding: 20px 24px;
    border-top: 2px solid var(--dust);
    background: var(--cream);
  }

  .cart-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 700;
  }
  .cart-total-price { color: var(--rust); font-size: 1.4rem; }

  .checkout-btn {
    width: 100%;
    background: var(--rust);
    color: var(--white);
    border: none;
    padding: 16px;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: background 0.2s, transform 0.1s;
  }
  .checkout-btn:hover { background: #a84f12; transform: translateY(-1px); }

  /* CHECKOUT MODAL */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.6);
    z-index: 300;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease;
  }
  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--white);
    border-radius: 12px;
    width: 90%;
    max-width: 520px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: modalIn 0.3s cubic-bezier(0.4,0,0.2,1);
  }
  @keyframes modalIn {
    from { opacity: 0; transform: scale(0.93) translateY(20px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }

  .modal-header {
    background: var(--bark);
    color: var(--white);
    padding: 24px 28px;
    border-radius: 12px 12px 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .modal-header h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.4rem;
    font-weight: 700;
  }

  .modal-body { padding: 28px; }

  .form-section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--dust);
    color: var(--rust);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  .form-group {
    margin-bottom: 16px;
  }
  .form-group.full { grid-column: 1 / -1; }
  .form-group label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--bark);
    margin-bottom: 6px;
    letter-spacing: 0.3px;
    text-transform: uppercase;
  }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    border: 1.5px solid var(--dust);
    border-radius: 5px;
    padding: 10px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem;
    background: var(--cream);
    color: var(--bark);
    outline: none;
    transition: border-color 0.2s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    border-color: var(--rust);
    background: var(--white);
  }
  .form-group textarea { resize: vertical; min-height: 80px; }

  .order-summary {
    background: var(--cream);
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 20px;
  }
  .order-summary-line {
    display: flex;
    justify-content: space-between;
    font-size: 0.88rem;
    margin-bottom: 8px;
    color: #666;
  }
  .order-summary-line.total {
    font-weight: 700;
    font-size: 1rem;
    color: var(--bark);
    border-top: 1px solid var(--dust);
    padding-top: 8px;
    margin-top: 4px;
  }

  .place-order-btn {
    width: 100%;
    background: var(--rust);
    color: var(--white);
    border: none;
    padding: 16px;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
  }
  .place-order-btn:hover { background: #a84f12; }

  /* SUCCESS STATE */
  .success-screen {
    text-align: center;
    padding: 40px 20px;
    display: none;
  }
  .success-screen.show { display: block; }
  .success-icon { font-size: 4rem; margin-bottom: 16px; }
  .success-screen h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 10px;
    color: var(--sage);
  }
  .success-screen p { color: #888; line-height: 1.6; }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 28px; right: 28px;
    background: var(--bark);
    color: var(--white);
    padding: 14px 20px;
    border-radius: 6px;
    font-size: 0.88rem;
    font-weight: 500;
    z-index: 999;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.35s cubic-bezier(0.4,0,0.2,1);
    display: flex; align-items: center; gap: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  }
  .toast.show { transform: translateY(0); opacity: 1; }

  @media (max-width: 900px) {
    .main-layout { grid-template-columns: 1fr; }
    .sidebar { position: static; }
  }
  @media (max-width: 600px) {
    header { padding: 0 20px; }
    .hero { padding: 36px 20px; }
    .main-layout { padding: 24px 16px; }
    .cart-drawer { width: 100%; }
    .form-row { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">Musanze<span>Market</span></div>
  <div class="header-right">
    <div class="search-bar">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input type="text" id="searchInput" placeholder="Search products‚Ä¶">
    </div>
    <button class="cart-btn" onclick="openCart()">
      üõí Cart
      <span class="cart-badge" id="cartBadge">0</span>
    </button>
  </div>
</header>

<!-- HERO -->
<div class="hero">
  <div class="hero-inner">
    <span class="hero-tag">üìç Musanze, Northern Rwanda</span>
    <h1>Fresh from the<br><em>local market</em></h1>
    <p>Support local vendors and artisans. Order fresh produce, handcrafted goods, and more ‚Äî delivered to your door.</p>
  </div>
</div>

<!-- MAIN -->
<div class="main-layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="filter-section">
      <h3>Categories</h3>
      <button class="category-btn active" onclick="filterCategory('all', this)">All Products</button>
      <button class="category-btn" onclick="filterCategory('produce', this)">ü•¨ Fresh Produce</button>
      <button class="category-btn" onclick="filterCategory('dairy', this)">ü•õ Dairy & Eggs</button>
      <button class="category-btn" onclick="filterCategory('crafts', this)">üß∫ Crafts & Baskets</button>
      <button class="category-btn" onclick="filterCategory('spices', this)">üå∂Ô∏è Spices & Herbs</button>
      <button class="category-btn" onclick="filterCategory('honey', this)">üçØ Honey & Jams</button>
    </div>

    <div class="filter-section">
      <h3>Max Price (RWF)</h3>
      <input type="range" id="priceRange" min="500" max="15000" value="15000" step="500" oninput="filterPrice(this.value)">
      <div class="price-labels">
        <span>500</span>
        <span id="priceLabel">15,000</span>
      </div>
    </div>

    <div class="filter-section">
      <h3>Vendor</h3>
      <button class="category-btn active-v" onclick="filterVendor('all', this)" id="vAll" style="background: var(--rust); color: white;">All Vendors</button>
      <button class="category-btn" onclick="filterVendor('Mama Grace', this)">Mama Grace</button>
      <button class="category-btn" onclick="filterVendor('Kagabo Farms', this)">Kagabo Farms</button>
      <button class="category-btn" onclick="filterVendor('Ntakirutimana', this)">Ntakirutimana</button>
      <button class="category-btn" onclick="filterVendor('Umurava Crafts', this)">Umurava Crafts</button>
    </div>
  </aside>

  <!-- PRODUCTS -->
  <main class="products-area">
    <div class="products-toolbar">
      <div class="products-count">Showing <strong id="countNum">0</strong> products</div>
      <select class="sort-select" id="sortSelect" onchange="sortProducts()">
        <option value="default">Sort: Featured</option>
        <option value="price-asc">Price: Low to High</option>
        <option value="price-desc">Price: High to Low</option>
        <option value="name-asc">Name: A‚ÄìZ</option>
      </select>
    </div>
    <div class="product-grid" id="productGrid"></div>
  </main>
</div>

<!-- CART DRAWER -->
<div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-header">
    <h2>Your Basket</h2>
    <button class="close-btn" onclick="closeCart()">‚úï</button>
  </div>
  <div class="cart-items" id="cartItems"></div>
  <div class="cart-footer" id="cartFooter" style="display:none">
    <div class="cart-total">
      <span>Total</span>
      <span class="cart-total-price" id="cartTotal">RWF 0</span>
    </div>
    <button class="checkout-btn" onclick="openCheckout()">Proceed to Checkout ‚Üí</button>
  </div>
</div>

<!-- CHECKOUT MODAL -->
<div class="modal-overlay" id="checkoutModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Checkout</h2>
      <button class="close-btn" onclick="closeCheckout()">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody">
      <div class="form-section-title">Delivery Details</div>
      <div class="form-row">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" placeholder="Amina">
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" placeholder="Uwimana">
        </div>
        <div class="form-group full">
          <label>Phone Number</label>
          <input type="tel" placeholder="+250 7XX XXX XXX">
        </div>
        <div class="form-group full">
          <label>Neighbourhood / Sector</label>
          <input type="text" placeholder="e.g. Cyuve Sector, Musanze">
        </div>
        <div class="form-group full">
          <label>Delivery Notes</label>
          <textarea placeholder="Near the blue gate‚Ä¶ next to the church‚Ä¶"></textarea>
        </div>
      </div>

      <div class="form-section-title">Payment Method</div>
      <div class="form-group">
        <label>Select Method</label>
        <select>
          <option>üì± Mobile Money (MTN MoMo)</option>
          <option>üì± Airtel Money</option>
          <option>üíµ Cash on Delivery</option>
        </select>
      </div>

      <div class="form-section-title">Order Summary</div>
      <div class="order-summary" id="orderSummary"></div>

      <button class="place-order-btn" onclick="placeOrder()">Place Order üéâ</button>
    </div>
    <div class="success-screen" id="successScreen">
      <div class="success-icon">‚úÖ</div>
      <h3>Order Placed!</h3>
      <p>Thank you for supporting local vendors.<br>Your order will be delivered soon.<br><br><strong>Murakoze cyane!</strong></p>
      <br>
      <button class="place-order-btn" style="max-width:200px;margin:auto" onclick="closeCheckout()">Continue Shopping</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast">
  <span>üõí</span>
  <span id="toastMsg">Added to cart!</span>
</div>

<script>
const PRODUCTS = [
  { id:1, name:'Ripe Avocados', vendor:'Kagabo Farms', category:'produce', price:2500, emoji:'ü•ë', badge:'Organic', desc:'Creamy, freshly harvested avocados from Musanze farms.' },
  { id:2, name:'Irish Potatoes', vendor:'Kagabo Farms', category:'produce', price:1800, emoji:'ü•î', badge:null, desc:'Premium Irish potatoes, perfect for all your meals.' },
  { id:3, name:'Garden Tomatoes', vendor:'Mama Grace', category:'produce', price:1200, emoji:'üçÖ', badge:'Fresh', desc:'Vine-ripened tomatoes picked this morning.' },
  { id:4, name:'Fresh Spinach', vendor:'Mama Grace', category:'produce', price:800, emoji:'ü•¨', badge:'Organic', desc:'Tender spinach leaves, grown without pesticides.' },
  { id:5, name:'Farm Eggs (12)', vendor:'Ntakirutimana', category:'dairy', price:3200, emoji:'ü•ö', badge:'Free Range', desc:'Free-range eggs from happy hens on local farms.' },
  { id:6, name:'Fresh Milk (1L)', vendor:'Ntakirutimana', category:'dairy', price:1500, emoji:'ü•õ', badge:null, desc:'Pure, unpasteurized cow milk from Musanze highlands.' },
  { id:7, name:'Woven Agaseke Basket', vendor:'Umurava Crafts', category:'crafts', price:12000, emoji:'üß∫', badge:'Handmade', desc:'Traditional Rwandan peace basket, intricately woven.' },
  { id:8, name:'Sisal Floor Mat', vendor:'Umurava Crafts', category:'crafts', price:8500, emoji:'ü™°', badge:'Artisan', desc:'Handwoven sisal mat with traditional geometric patterns.' },
  { id:9, name:'Dried Chili Powder', vendor:'Mama Grace', category:'spices', price:1500, emoji:'üå∂Ô∏è', badge:'Hot', desc:'Sun-dried and ground local chili, rich aroma.' },
  { id:10, name:'Rosemary Bundle', vendor:'Mama Grace', category:'spices', price:700, emoji:'üåø', badge:null, desc:'Fresh rosemary cut from the mountain herb gardens.' },
  { id:11, name:'Volcanic Honey (500g)', vendor:'Kagabo Farms', category:'honey', price:6500, emoji:'üçØ', badge:'Raw', desc:'Raw honey from bees foraging Virunga mountain flowers.' },
  { id:12, name:'Passion Fruit Jam', vendor:'Mama Grace', category:'honey', price:4200, emoji:'ü´ô', badge:'Homemade', desc:'Sweet-tangy jam made from freshly pressed passion fruits.' },
  { id:13, name:'Eggplant / Intore', vendor:'Kagabo Farms', category:'produce', price:1100, emoji:'üçÜ', badge:null, desc:'Deep purple eggplants, ideal for grilling and stewing.' },
  { id:14, name:'Goat Yogurt (350ml)', vendor:'Ntakirutimana', category:'dairy', price:2200, emoji:'ü´ô', badge:'Probiotic', desc:'Creamy goat milk yogurt, naturally cultured.' },
  { id:15, name:'Cinnamon & Clove Mix', vendor:'Mama Grace', category:'spices', price:2000, emoji:'ü™µ', badge:null, desc:'Aromatic spice blend for tea, stew, and baking.' },
  { id:16, name:'Decorative Wall Basket', vendor:'Umurava Crafts', category:'crafts', price:14500, emoji:'üé®', badge:'Limited', desc:'Statement piece ‚Äî bold patterns woven in natural dyes.' },
];

let cart = {};
let activeCategory = 'all';
let maxPrice = 15000;
let activeVendor = 'all';
let searchQuery = '';
let sortMode = 'default';

function getFiltered() {
  let list = [...PRODUCTS];
  if (activeCategory !== 'all') list = list.filter(p => p.category === activeCategory);
  if (activeVendor !== 'all') list = list.filter(p => p.vendor === activeVendor);
  list = list.filter(p => p.price <= maxPrice);
  if (searchQuery) list = list.filter(p => p.name.toLowerCase().includes(searchQuery) || p.vendor.toLowerCase().includes(searchQuery));
  if (sortMode === 'price-asc') list.sort((a,b) => a.price - b.price);
  if (sortMode === 'price-desc') list.sort((a,b) => b.price - a.price);
  if (sortMode === 'name-asc') list.sort((a,b) => a.name.localeCompare(b.name));
  return list;
}

function renderProducts() {
  const grid = document.getElementById('productGrid');
  const list = getFiltered();
  document.getElementById('countNum').textContent = list.length;
  if (list.length === 0) {
    grid.innerHTML = `<div class="empty-state"><div>üîç</div><p>No products found. Try adjusting your filters.</p></div>`;
    return;
  }
  grid.innerHTML = list.map((p, i) => `
    <div class="product-card" style="animation-delay:${i*0.05}s">
      <div class="product-img">${p.emoji}${p.badge ? `<span class="product-badge">${p.badge}</span>` : ''}</div>
      <div class="product-info">
        <div class="vendor-tag">${p.vendor}</div>
        <div class="product-name">${p.name}</div>
        <div class="product-desc">${p.desc}</div>
        <div class="product-footer">
          <div class="product-price">RWF ${p.price.toLocaleString()} <span>/unit</span></div>
          <button class="add-btn" onclick="addToCart(${p.id})" title="Add to cart">+</button>
        </div>
      </div>
    </div>
  `).join('');
}

function addToCart(id) {
  const product = PRODUCTS.find(p => p.id === id);
  if (!cart[id]) cart[id] = { ...product, qty: 0 };
  cart[id].qty++;
  updateCartBadge();
  showToast(`${product.emoji} ${product.name} added!`);
}

function updateCartBadge() {
  const total = Object.values(cart).reduce((s, i) => s + i.qty, 0);
  document.getElementById('cartBadge').textContent = total;
}

function openCart() {
  document.getElementById('cartOverlay').classList.add('open');
  document.getElementById('cartDrawer').classList.add('open');
  renderCart();
}
function closeCart() {
  document.getElementById('cartOverlay').classList.remove('open');
  document.getElementById('cartDrawer').classList.remove('open');
}

function renderCart() {
  const container = document.getElementById('cartItems');
  const footer = document.getElementById('cartFooter');
  const items = Object.values(cart).filter(i => i.qty > 0);
  if (items.length === 0) {
    container.innerHTML = `<div class="cart-empty"><div>üß∫</div><p>Your basket is empty.<br>Add some local goods!</p></div>`;
    footer.style.display = 'none';
    return;
  }
  container.innerHTML = items.map(item => `
    <div class="cart-item">
      <div class="cart-item-emoji">${item.emoji}</div>
      <div>
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-vendor">${item.vendor}</div>
      </div>
      <div class="cart-item-controls">
        <div class="cart-item-price">RWF ${(item.price * item.qty).toLocaleString()}</div>
        <div class="qty-ctrl">
          <button class="qty-btn" onclick="changeQty(${item.id}, -1)">‚àí</button>
          <span class="qty-num">${item.qty}</span>
          <button class="qty-btn" onclick="changeQty(${item.id}, 1)">+</button>
        </div>
      </div>
    </div>
  `).join('');
  const total = items.reduce((s, i) => s + i.price * i.qty, 0);
  document.getElementById('cartTotal').textContent = `RWF ${total.toLocaleString()}`;
  footer.style.display = 'block';
}

function changeQty(id, delta) {
  if (!cart[id]) return;
  cart[id].qty = Math.max(0, cart[id].qty + delta);
  if (cart[id].qty === 0) delete cart[id];
  updateCartBadge();
  renderCart();
}

function openCheckout() {
  closeCart();
  const items = Object.values(cart).filter(i => i.qty > 0);
  const total = items.reduce((s, i) => s + i.price * i.qty, 0);
  document.getElementById('orderSummary').innerHTML = `
    ${items.map(i => `<div class="order-summary-line"><span>${i.emoji} ${i.name} √ó${i.qty}</span><span>RWF ${(i.price*i.qty).toLocaleString()}</span></div>`).join('')}
    <div class="order-summary-line total"><span>Total</span><span>RWF ${total.toLocaleString()}</span></div>
  `;
  document.getElementById('successScreen').classList.remove('show');
  document.getElementById('modalBody').style.display = 'block';
  document.getElementById('checkoutModal').classList.add('open');
}
function closeCheckout() {
  document.getElementById('checkoutModal').classList.remove('open');
}

function placeOrder() {
  cart = {};
  updateCartBadge();
  document.getElementById('modalBody').style.display = 'none';
  document.getElementById('successScreen').classList.add('show');
}

function filterCategory(cat, btn) {
  activeCategory = cat;
  document.querySelectorAll('.category-btn').forEach(b => {
    if (!b.id || b.id.startsWith('v')) return;
    b.classList.remove('active');
  });
  btn.classList.add('active');
  renderProducts();
}

function filterVendor(vendor, btn) {
  activeVendor = vendor;
  document.querySelectorAll('.category-btn').forEach(b => {
    if (!b.onclick || !b.onclick.toString().includes('filterVendor')) return;
    b.style.background = ''; b.style.color = '';
  });
  btn.style.background = 'var(--rust)';
  btn.style.color = 'white';
  renderProducts();
}

function filterPrice(val) {
  maxPrice = parseInt(val);
  document.getElementById('priceLabel').textContent = parseInt(val).toLocaleString();
  renderProducts();
}

function sortProducts() {
  sortMode = document.getElementById('sortSelect').value;
  renderProducts();
}

document.getElementById('searchInput').addEventListener('input', e => {
  searchQuery = e.target.value.toLowerCase();
  renderProducts();
});

let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  document.getElementById('toastMsg').textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
}

// Init
renderProducts();
</script>
</body>
</html>